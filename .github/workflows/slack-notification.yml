name: Slack Notification

on:
  push:
    branches:
      - main # ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«å®Ÿè¡Œ
    paths-ignore:
      - "**.md" # Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã¯ç„¡è¦–

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # ã™ã¹ã¦ã®ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’å–å¾—

      - name: Get commit messages
        id: get_commits
        run: |
          # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
          COMMITS=$(git log --pretty=format:"%h - %s (%an)" ${{ github.event.before }}..${{ github.event.after }})
          echo "commits<<EOF" >> $GITHUB_OUTPUT
          echo "$COMMITS" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Send to Slack
        uses: slackapi/slack-github-action@v1.24.0
        with:
          channel-id: "git_merge_history" # é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹Slackãƒãƒ£ãƒ³ãƒãƒ«
          slack-message: |
            ğŸš€ æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸ

            ğŸ“ ã‚³ãƒŸãƒƒãƒˆå†…å®¹:
            ```
            ${{ steps.get_commits.outputs.commits }}
            ```

            ğŸ‘¤ ã‚³ãƒŸãƒƒã‚¿ãƒ¼: ${{ github.actor }}
            ğŸ”— ãƒªãƒã‚¸ãƒˆãƒª: ${{ github.repository }}
            ğŸŒ¿ ãƒ–ãƒ©ãƒ³ãƒ: ${{ github.ref_name }}
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_API_TOKEN }}
